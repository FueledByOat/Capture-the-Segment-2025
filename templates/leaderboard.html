{% extends "base.html" %}
{% block title %}Leaderboard{% endblock %}
{% block content %}
<h2>Segment Leaderboard</h2>

<form method="get" action="/leaderboard">
  <label for="segment_id">Select Segment:</label>
  <select name="segment_id" id="segment_id" onchange="this.form.submit()">
    <option value="">--Choose--</option>
    {% for s in segments %}
      <option value="{{ s.segment_id }}" {% if selected_id == s.segment_id|string %}selected{% endif %}>
        {{ s.segment_name }} ({{ s.segment_id }})
      </option>
    {% endfor %}
  </select>
</form>

{% if efforts %}
<p>
  <a href="{{ url_for('export_leaderboard', segment_id=selected_id) }}" class="button">⬇️ Export CSV</a>
</p>

<table>
  <thead>
    <tr>
      <th>Segment ID</th>
      <th>Segment Name</th>
      <th>Athlete</th>
      <th>Best Time (s)</th>
      <th>Points</th>
    </tr>
  </thead>
  <tbody>
    {% for row in efforts %}
    <tr>
      <td><a href="https://www.strava.com/segments/{{ row.segment_id }}" target="_blank">{{ row.segment_id }}</a></td>
      <td>{{ row.segment_name }}</td>
      <td>{{ row.athlete_name }}</td>
      <td>{{ row.best_time }}</td>
      <td>{{ row.points }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}
{% endblock %}
